<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Reason Why | Enterprise Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            purple: '#302039',
                            yellow: '#f9db02',
                            white: '#ffffff'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-item:hover { background-color: rgba(249, 219, 2, 0.1); border-right: 4px solid #f9db02; }
        .company-card:hover { transform: translateY(-5px); border-color: #f9db02; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .admin-only { display: none; }
        .bg-gradient-brand { background: linear-gradient(135deg, #302039 0%, #4a3158 100%); }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans">

    <header class="bg-brand-purple text-white p-4 sticky top-0 z-50 shadow-lg border-b-4 border-brand-yellow">
        <div class="max-w-full mx-auto flex justify-between items-center px-6">
            <div class="flex items-center gap-6">
                <h1 class="font-black uppercase text-lg tracking-widest">Reason <span class="text-brand-yellow italic">Why</span></h1>
                <div id="active-client" class="hidden text-[10px] bg-white/10 px-4 py-1 rounded-full border border-white/20 uppercase font-bold text-brand-yellow">
                    <i class="fa-solid fa-building mr-2"></i> <span id="client-name-display">Seleccionar Cliente</span>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div id="user-info" class="text-right mr-4">
                    <p id="user-email" class="text-[10px] font-bold text-slate-300">Usuario no autenticado</p>
                    <p id="user-role" class="text-[9px] uppercase text-brand-yellow font-black">Visitante</p>
                </div>
                <button onclick="loginGoogle()" class="bg-brand-yellow text-brand-purple px-5 py-2 rounded-full font-black text-xs uppercase hover:bg-white transition-all shadow-md">
                    <i class="fa-brands fa-google mr-2"></i> Acceso Gmail
                </button>
            </div>
        </div>
    </header>

    <div class="flex">
        <aside class="w-80 bg-brand-purple min-h-[calc(100vh-72px)] p-8 flex flex-col border-r border-white/10 shadow-2xl">
            <div class="space-y-6 flex-grow">
                <div>
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">Consultoría</span>
                    <nav class="mt-4 space-y-2">
                        <button onclick="irA('clientes')" class="sidebar-item w-full text-left p-4 rounded-xl text-white font-bold text-sm flex items-center gap-4 transition-all">
                            <i class="fa-solid fa-folder-tree text-brand-yellow"></i> DIRECTORIO EMPRESAS
                        </button>
                        <button id="nav-registro" onclick="irA('registro')" class="sidebar-item w-full text-left p-4 rounded-xl text-white font-bold text-sm flex items-center gap-4 transition-all opacity-50 cursor-not-allowed" disabled>
                            <i class="fa-solid fa-microphone-lines text-brand-yellow"></i> REGISTRO DE VOZ
                        </button>
                        <button id="nav-dashboard" onclick="irA('dashboard')" class="sidebar-item w-full text-left p-4 rounded-xl text-white font-bold text-sm flex items-center gap-4 transition-all opacity-50 cursor-not-allowed" disabled>
                            <i class="fa-solid fa-brain text-brand-yellow"></i> DASHBOARD RAG
                        </button>
                    </nav>
                </div>

                <div class="admin-only border-t border-white/10 pt-8">
                    <span class="text-[10px] font-black text-brand-yellow uppercase tracking-[0.2em]">Seguridad & Control</span>
                    <nav class="mt-4 space-y-2">
                        <button onclick="irA('usuarios')" class="sidebar-item w-full text-left p-4 rounded-xl text-white font-bold text-sm flex items-center gap-4 transition-all">
                            <i class="fa-solid fa-user-lock text-brand-yellow"></i> PERMISOS LEY 21.719
                        </button>
                        <button onclick="modalNuevoCliente()" class="w-full bg-brand-yellow text-brand-purple p-4 rounded-xl font-black text-xs uppercase mt-6 hover:scale-105 transition-all shadow-lg">
                            + Crear Nuevo Cliente
                        </button>
                    </nav>
                </div>
            </div>
            
            <div class="bg-white/5 p-4 rounded-2xl border border-white/10">
                <p class="text-[9px] text-slate-400 leading-tight">Sistema protegido bajo protocolos de encriptación AES-256 y cumplimiento normativo Ley 21.719.</p>
            </div>
        </aside>

        <main class="flex-1 p-10 h-[calc(100vh-72px)] overflow-y-auto">
            
            <section id="vista-clientes" class="space-y-8">
                <div class="flex justify-between items-center border-b pb-6">
                    <div>
                        <h2 class="text-3xl font-black text-brand-purple">Gestión de Clientes</h2>
                        <p class="text-slate-500 font-medium">Seleccione el ecosistema de la empresa para iniciar el análisis.</p>
                    </div>
                </div>
                <div id="grid-empresas" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div onclick="seleccionarEmpresa('CLIENTE_01', 'Minera del Norte')" class="company-card bg-white border-2 border-slate-100 p-10 rounded-[2.5rem] transition-all flex flex-col items-center shadow-sm">
                        <div class="w-20 h-20 bg-brand-purple/5 rounded-full flex items-center justify-center mb-6 border border-brand-purple/10">
                            <i class="fa-solid fa-folder-open text-brand-purple text-4xl"></i>
                        </div>
                        <h3 class="font-black text-brand-purple text-lg uppercase tracking-tighter">Minera del Norte</h3>
                        <span class="bg-brand-yellow/20 text-brand-purple text-[9px] font-black px-4 py-1 rounded-full mt-4">14 AUDITORÍAS ACTIVAS</span>
                    </div>
                </div>
            </section>

            <section id="vista-registro" class="hidden space-y-8">
                <div class="bg-gradient-brand p-10 rounded-[3rem] text-white shadow-2xl relative overflow-hidden">
                    <div class="relative z-10">
                        <h2 class="text-3xl font-black mb-2 italic">Registro de Hallazgos</h2>
                        <p class="text-brand-yellow font-bold uppercase text-[10px] tracking-widest">Empresa Activa: <span id="active-company-name">---</span></p>
                    </div>
                    <i class="fa-solid fa-microphone-lines absolute top-[-20px] right-[-20px] text-white/5 text-[15rem]"></i>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-3xl border shadow-sm border-slate-200">
                        <label class="text-[10px] font-black uppercase text-brand-purple mb-2 block">Consultor Responsable</label>
                        <div class="flex items-center bg-slate-50 rounded-2xl border px-4">
                            <input type="text" id="entrevistador" class="w-full p-4 bg-transparent outline-none text-xs font-bold">
                            <button onclick="dictar('entrevistador')"><i class="fa-solid fa-microphone text-brand-purple hover:text-brand-yellow transition-colors"></i></button>
                        </div>
                    </div>
                    </div>
                </section>

            <section id="vista-dashboard" class="hidden space-y-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white p-10 rounded-[3rem] border border-slate-200 shadow-xl">
                        <h3 class="font-black text-brand-purple uppercase text-sm mb-6 flex items-center gap-3">
                            <i class="fa-solid fa-robot text-brand-yellow"></i> Análisis RAG (No-Alucinación)
                        </h3>
                        <div class="bg-slate-900 text-white p-6 rounded-2xl font-mono text-xs leading-relaxed border-l-8 border-brand-yellow">
                            <p id="rag-output">Seleccione un conjunto de datos para que la IA genere el resumen basado estrictamente en el contexto SQL encriptado.</p>
                        </div>
                    </div>
                    <div class="bg-brand-purple p-10 rounded-[3rem] text-white flex flex-col justify-center items-center shadow-2xl border-b-8 border-brand-yellow">
                        <span class="text-xs font-black text-brand-yellow uppercase tracking-widest mb-4">Total Hallazgos</span>
                        <span class="text-8xl font-black italic">42</span>
                    </div>
                </div>
            </section>

            <section id="vista-usuarios" class="hidden space-y-8">
                <div class="bg-white p-10 rounded-[3rem] border-2 border-brand-purple/10 shadow-sm">
                    <h2 class="text-2xl font-black text-brand-purple mb-2">Control de Identidad</h2>
                    <p class="text-slate-400 text-sm mb-10 italic">Solo los usuarios Gmail listados aquí tendrán acceso a los datos de sus respectivas carpetas de empresa.</p>
                    
                    <div class="flex gap-4 mb-10">
                        <input type="email" id="gmail-nuevo" placeholder="colaborador@gmail.com" class="flex-1 bg-slate-50 border-2 border-slate-100 p-4 rounded-2xl outline-none focus:border-brand-yellow transition-all">
                        <select id="rol-nuevo" class="bg-slate-50 border-2 border-slate-100 p-4 rounded-2xl font-bold text-xs">
                            <option value="lector">Solo Lectura</option>
                            <option value="consultor">Consultor (Voz + Excel)</option>
                            <option value="admin">Administrador Total</option>
                        </select>
                        <button onclick="autorizarGmail()" class="bg-brand-purple text-brand-yellow px-10 rounded-2xl font-black uppercase text-xs hover:bg-brand-purple/90 transition-all">Autorizar Acceso</button>
                    </div>

                    <div id="lista-autorizados" class="space-y-4">
                        </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        // LÓGICA DE NAVEGACIÓN
        function irA(id) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`vista-${id}`).classList.remove('hidden');
        }

        // LÓGICA DE EMPRESA (CARPETAS)
        function seleccionarEmpresa(id, nombre) {
            // Anclaje de sesión
            document.getElementById('active-client').classList.remove('hidden');
            document.getElementById('client-name-display').innerText = nombre;
            document.getElementById('active-company-name').innerText = nombre;
            
            // Habilitar módulos
            document.getElementById('nav-registro').classList.remove('opacity-50', 'cursor-not-allowed');
            document.getElementById('nav-registro').disabled = false;
            document.getElementById('nav-dashboard').classList.remove('opacity-50', 'cursor-not-allowed');
            document.getElementById('nav-dashboard').disabled = false;
            
            irA('registro');
        }

        // LÓGICA DE SEGURIDAD (LEY 21.719)
        async function loginGoogle() {
            // Aquí llamarías a supabase.auth.signInWithOAuth({ provider: 'google' })
            // Tras el login, verificaríamos si el correo existe en la tabla SQL 'usuarios_autorizados'
            alert("Redirigiendo a autenticación de Google segura...");
            document.querySelectorAll('.admin-only').forEach(e => e.style.display = 'block');
            document.getElementById('user-role').innerText = "ADMINISTRADOR";
            document.getElementById('user-email').innerText = "admin@reasonwhy.com";
        }

        function autorizarGmail() {
            const email = document.getElementById('gmail-nuevo').value;
            if(email) {
                const lista = document.getElementById('lista-autorizados');
                lista.innerHTML += `
                    <div class="flex justify-between items-center bg-slate-50 p-6 rounded-2xl border border-slate-100">
                        <div>
                            <p class="font-black text-brand-purple text-sm">${email}</p>
                            <p class="text-[9px] uppercase font-bold text-slate-400">Acceso vinculado a Google Auth</p>
                        </div>
                        <button class="text-rose-500 font-black text-xs uppercase hover:underline">Revocar</button>
                    </div>
                `;
            }
        }

        // MICROFONOS (DICECTORIO INDIVIDUAL)
        function dictar(id) {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'es-ES';
            recognition.start();
            recognition.onresult = (e) => {
                document.getElementById(id).value = e.results[0][0].transcript;
            };
        }
    </script>
</body>
</html>
